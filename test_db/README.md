# Задание по выбору хранилища

В качестве кандидатов для выбора хранилища для обработки аналитических данных были выбраны ClickHouse и Vertica. 
Были преприняты так же попытки протестировать CassandraDB, однако уже на 2млн записей Cassandra отказывалась исполнять какие-либо запросы на чтение за разумное время. По этой причине в тестах она не участвовала.

Условия тестов:
Ресурсы контейнера для БД - 8гб оперативной памяти, 8 CPU,
до начала тестов в контейнер помещались 10млн записей, по 1000 уникальных UUID для пользователей и фильмов

Описания тестов:
- `select_average_timestamps` - достать `id` всех фильмов со средним временем их просмотра
- `select_max_timestamp_by_user_movie` - достать timestamp, на котором остановился пользователь при просмотре фильма
- `select_max_timestamps_by_user` - достать timestamp-ы, на которых остановился пользователь для всех фильмов
- `select_movies_by_user` - достать id фильмов, которые просматривал пользователь
- `select_users_by_movie` - достать id пользователей, которые просматривали фильм
- `insert_batch_{batch_size}` - вставка батча

Описания схем и запросов доступны в папках с тестами соответствующих баз.

Для тестирования запросов под нагрузкой запускался дополнительный процесс, генерирующий 100 запросов на вставку в секунду.
Размер батча для ClickHouse - 100 записей. Для нагрузки в 200 рпс запускался еще один такой процесс.

## Результаты тестов
### ClickHouse
| Тест | Без нагрузки, мс | 100 RPS, мс | 200 RPS, мс |
|---|:---:|:---:|:---:|
| `select_average_timestamps` | 56.62+-12.77 | 77.93+-4.13 | 188.93+-89.62 |
| `select_max_timestamp_by_user_movie` | 5.51+-0.77 | 6.58+-1.32 | 9.65+-2.34 |
| `select_max_timestamps_by_user` | 7.24+-1.33 | 8.07+-3.02 | 11.15+-4.05 |
| `select_movies_by_user` | 5.47+-0.73 | 6.72+-1.34 | 9.47+-4.33 |
| `select_users_by_movie` | 54.23+-7.17 | 68.63+-9.81 | 203.28+-11218 |
| `insert_batch_1` | 7.55+-2.16 | 6.57+-1.88 | 9.40+-11.48 |
| `insert_batch_100` | 7.62+-1.78 | 7.86+-2.11 | 12.78+-20.57 |
| `insert_batch_1000` | 13.51+-2.13 | 13.01+-2.56 | 17.80+-12.74 |
